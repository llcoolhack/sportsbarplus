<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Sportsbar</title>

  <!-- Tab icon / favicon -->
  <link rel="icon" type="image/png" href="sportsbar-icon.png">

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://unpkg.com/@ungap/custom-elements-builtin"></script>
  <script type="module" src="https://unpkg.com/x-frame-bypass"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
      color: #fff;
    }

    /* ---------- LOGIN SCREEN ---------- */
    #login-screen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, #1c2333 0%, #05060a 55%, #000 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      transition: opacity 0.3s ease;
    }

    #login-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .login-card {
      background: rgba(10, 12, 20, 0.95);
      border-radius: 16px;
      padding: 32px 28px 26px;
      width: 320px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(120, 180, 255, 0.25);
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .login-logo {
      font-size: 24px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.28em;
      text-align: center;
      background: linear-gradient(120deg, #00ffd1, #10b4ff, #ff2f6e);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 14px rgba(0, 255, 209, 0.35);
    }

    .login-subtitle {
      font-size: 13px;
      text-align: center;
      color: #c5ccdd;
      margin-bottom: 4px;
    }

    .login-card label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ea5bc;
      margin-bottom: 4px;
    }

    .login-input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #333b4f;
      background: #050711;
      color: #fff;
      font-size: 13px;
      box-sizing: border-box;
      outline: none;
    }

    .login-input:focus {
      border-color: #2aa7ff;
      box-shadow: 0 0 0 1px rgba(42, 167, 255, 0.45);
    }

    .login-remember-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
    }

    .login-remember-row input[type="checkbox"] {
      width: 14px;
      height: 14px;
      cursor: pointer;
    }

    .login-remember-row label.login-remember-label {
      font-size: 11px;
      text-transform: none;
      letter-spacing: 0.02em;
      color: #c5ccdd;
      cursor: pointer;
    }

    .login-button {
      margin-top: 8px;
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #00ffd1, #10b4ff);
      color: #050711;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .login-button:hover {
      filter: brightness(1.06);
    }

    #login-error {
      display: none;
      margin-top: 6px;
      font-size: 11px;
      color: #ff4f6a;
      text-align: center;
    }

    /* ---------- APP LAYOUT ---------- */
    #container {
      width: 100vw;
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    #sidebar {
      width: 260px;
      background: #111;
      padding: 10px;
      box-sizing: border-box;
      overflow-y: auto;
      transition: width 0.25s ease, padding 0.25s ease, opacity 0.25s ease;
      z-index: 10;
    }
    #sidebar.hidden {
      width: 0 !important;
      padding: 0 !important;
      opacity: 0;
    }

    #screen {
      flex: 1;
      position: relative;
      background: #000;
      overflow: hidden;
    }

    /* Top-right controls with fade / auto-hide */
    #top-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 20;
      display: flex;
      gap: 8px;
      opacity: 1;
      transition: opacity 0.3s ease;
    }
    #top-controls.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #top-controls button {
      padding: 6px 10px;
      background: #1e88e5;
      border: none;
      border-radius: 999px;
      color: #fff;
      cursor: pointer;
      font-size: 11px;
      white-space: nowrap;
    }

    .panel {
      position: absolute;
      overflow: hidden;
      background: #000;
      border: 1px solid #222;
      box-sizing: border-box;
    }

    .panel-media {
      position: absolute;
      inset: 0;
    }

    .panel video {
      width: 100%;
      height: 100%;
      object-fit: fill;
      background: #000;
    }

    .panel-iframe {
      width: 100%;
      height: 100%;
      border: 0;
      background: #000;
    }

    .panel.drag-over {
      outline: 3px dashed #1e88e5;
    }

    .panel-label {
      position: absolute;
      bottom: 4px;
      left: 6px;
      font-size: 11px;
      background: rgba(0,0,0,0.6);
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* Active panel highlight */
    .panel-active {
      border-color: rgba(0, 255, 184, 0.9);
      box-shadow: 0 0 20px rgba(0, 255, 184, 0.5);
      transform: translateY(-1px);
    }

    /* Panel controls (reload on hover) */
    .panel-controls {
      position: absolute;
      top: 6px;
      right: 6px;
      display: flex;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.2s ease;
      z-index: 5;
    }
    .panel:hover .panel-controls {
      opacity: 1;
    }
    .panel-reload-btn {
      padding: 4px 6px;
      border-radius: 999px;
      border: none;
      background: rgba(0,0,0,0.6);
      color: #fff;
      font-size: 11px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .panel-reload-btn:hover {
      background: rgba(30,136,229,0.9);
    }

    .panelButton {
      width: 100%;
      padding: 6px;
      margin-bottom: 6px;
      background: #333;
      border: none;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      font-size: 12px;
      text-align: left;
    }
    .panelSelected {
      background: #1e88e5 !important;
      border: 2px solid #4dabf7;
    }

    .group {
      margin-bottom: 8px;
      border-radius: 6px;
      background: #181818;
      overflow: hidden;
      border: 1px solid #333;
    }

    .group-header {
      padding: 6px 8px;
      font-size: 12px;
      font-weight: bold;
      background: #222;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      user-select: none;
    }
    .group-header span.chevron {
      font-size: 11px;
      opacity: 0.8;
    }

    .group-channels {
      display: none;
      padding: 6px;
    }

    .channel-card {
      width: 100%;
      margin-bottom: 6px;
      padding: 6px 8px;
      background: #202434;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: #fff;
      cursor: pointer;
      font-size: 12px;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.15s ease, border 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease;
    }

    .channel-card:hover {
      background: #2b3246;
      border-color: rgba(0, 255, 184, 0.6);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.5);
      transform: translateY(-1px);
    }

    .channel-logo {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      object-fit: contain;
      background: #000;
      flex-shrink: 0;
    }

    .channel-meta {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 0;
    }

    .channel-name {
      font-size: 13px;
      font-weight: 600;
      color: #ffffff;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .channel-tag {
      font-size: 10px;
      text-transform: none;
      letter-spacing: 0.02em;
      opacity: 0.9;
      color: #c5ccdd;
    }

    .channel-live-badge {
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      padding: 3px 6px;
      border-radius: 999px;
      background: radial-gradient(circle, #ff2965 0%, #ff9100 100%);
      color: #ffffff;
      flex-shrink: 0;
    }

    /* Cast / full-screen panel mode */
    body.cast-mode #sidebar {
      display: none !important;
    }
    body.cast-mode #container {
      width: 100vw;
      height: 100vh;
    }
    body.cast-mode #screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1;
      background: #000;
    }
    body.cast-mode .panel {
      display: none !important;
    }
    body.cast-mode .panel.cast-active {
      display: block !important;
      left: 0 !important;
      top: 0 !important;
      width: 100% !important;
      height: 100% !important;
      border: none !important;
      border-radius: 0 !important;
      box-shadow: none !important;
    }
  </style>
</head>
<body>

<!-- LOGIN OVERLAY -->
<div id="login-screen">
  <div class="login-card">
    <div class="login-logo">SPORTSBAR</div>
    <div class="login-subtitle">Admin Control Panel</div>

    <div>
      <label for="login-username">Username</label>
      <input id="login-username" class="login-input" type="text" autocomplete="username" />
    </div>

    <div>
      <label for="login-password">Password</label>
      <input id="login-password" class="login-input" type="password" autocomplete="current-password" />
    </div>

    <div class="login-remember-row">
      <input type="checkbox" id="login-remember" />
      <label for="login-remember" class="login-remember-label">Stay logged in on this device</label>
    </div>

    <button id="login-button" class="login-button">Enter</button>
    <div id="login-error">Incorrect username or password.</div>
  </div>
</div>

<!-- APP UI -->
<div id="container">
  <div id="sidebar">
    <h3 style="margin:4px 0 8px 0;font-size:14px;">Select Panel</h3>
    <button class="panelButton panelSelected" data-video="video1">Top Left</button>
    <button class="panelButton" data-video="video2">Top Right</button>
    <button class="panelButton" data-video="video3">Bottom Left</button>
    <button class="panelButton" data-video="video4">Bottom Right</button>

    <h3 style="margin:12px 0 6px 0;font-size:14px;">Channels</h3>
    <button id="btnCustomUrl" class="panelButton">+ Custom URL</button>
    <div id="channelGroups"></div>
  </div>

  <div id="screen">
    <div id="top-controls">
      <button id="toggleSidebar">Hide Channels</button>
      <button id="togglePageFs">Fullscreen Page</button>
      <button id="toggleCastMode">Full Screen Panel</button>
    </div>

    <div class="panel panel-active" id="panel1" draggable="true" data-video="video1">
      <div class="panel-media" id="media_video1">
        <video id="video1" class="stream-player" autoplay muted playsinline></video>
      </div>
      <div class="panel-media" id="media_web1" style="display:none;">
        <iframe is="x-frame-bypass" id="web1" class="panel-iframe" allowfullscreen></iframe>
      </div>
      <div class="panel-label" id="label_video1">Panel 1</div>
    </div>

    <div class="panel" id="panel2" draggable="true" data-video="video2">
      <div class="panel-media" id="media_video2">
        <video id="video2" class="stream-player" autoplay muted playsinline></video>
      </div>
      <div class="panel-media" id="media_web2" style="display:none;">
        <iframe is="x-frame-bypass" id="web2" class="panel-iframe" allowfullscreen></iframe>
      </div>
      <div class="panel-label" id="label_video2">Panel 2</div>
    </div>

    <div class="panel" id="panel3" draggable="true" data-video="video3">
      <div class="panel-media" id="media_video3">
        <video id="video3" class="stream-player" autoplay muted playsinline></video>
      </div>
      <div class="panel-media" id="media_web3" style="display:none;">
        <iframe is="x-frame-bypass" id="web3" class="panel-iframe" allowfullscreen></iframe>
      </div>
      <div class="panel-label" id="label_video3">Panel 3</div>
    </div>

    <div class="panel" id="panel4" draggable="true" data-video="video4">
      <div class="panel-media" id="media_video4">
        <video id="video4" class="stream-player" autoplay muted playsinline></video>
      </div>
      <div class="panel-media" id="media_web4" style="display:none;">
        <iframe is="x-frame-bypass" id="web4" class="panel-iframe" allowfullscreen></iframe>
      </div>
      <div class="panel-label" id="label_video4">Panel 4</div>
    </div>
  </div>
</div>

<script>
/* --------- LOGIN CONFIG --------- */
const VALID_USERNAME = "SportsbarAdmin";
const VALID_PASSWORD = "CowboysTrojansMavericks4157";
const REMEMBER_KEY = "sportsbar_stay_logged_in";

/* --------- CHANNEL DEFINITIONS (logos) --------- */

const CHANNEL_GROUPS = {
  "US FTA": [
    {
      channel: "NBC",
      logo: "https://img.zuzz.tv/assets/channels/leP0I9zVkdBVQUefXv9iSgvK7vMtNTqlRwNZGST7ED8aHoMcgA.png",
      links: [
        "https://fl1.moveonjoy.com/NBC/index.m3u8"
      ]
    },
    {
      channel: "CBS",
      logo: "https://img.zuzz.tv/assets/channels/CBS.png",
      links: [
        "https://fl1.moveonjoy.com/CBS/index.m3u8"
      ]
    },
    {
      channel: "ABC",
      logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/ABC-2021-LOGO.svg/2560px-ABC-2021-LOGO.svg.png",
      links: [
        "https://fl1.moveonjoy.com/ABC/index.m3u8"
      ]
    },
    {
      channel: "TNT",
      logo: "https://img.zuzz.tv/assets/channels/oJBjZDXoV5MyJ2GduEASuGGvqvyP00o0YsgsSSwhzR4Dl3wndB.png",
      links: [
        "http://84.17.40.25/TNT/index.m3u8"
      ]
    },
    {
      channel: "FOX",
      logo: "https://img.zuzz.tv/assets/channels/qvaWX6mlwH0ZtIN66wd9qnN5DaLIMw6IeRjGrQaViGNjZIVcsI.png",
      links: [
        "https://fl1.moveonjoy.com/FOX/index.m3u8"
      ]
    },
    {
      channel: "TBS",
      logo: "https://img.zuzz.tv/assets/channels/8xATOcQY2eBC8e4MoBuYkunNjerUuTIf8kIQck1kxz7nqFAZXC.png",
      links: [
        "https://fl31.moveonjoy.com/TBS/index.m3u8"
      ]
    },
    {
      channel: "USA",
      logo: "https://img.zuzz.tv/assets/channels/j6IDLeDYF3QFLoNE2vHQEu7SZcvNFt0QnHmApJqckwuHlcOJhx.png",
      links: [
        "https://fl31.moveonjoy.com/USA_NETWORK/index.m3u8"
      ]
    }
  ],
  "Australia": [
    {
      channel: "Sky Racing 1",
      logo: "https://upload.wikimedia.org/wikipedia/en/9/93/Sky_au_racing.png",
      links: [
        "https://skylivetab-new.akamaized.net/hls/live/2038780/sky1/index.m3u8"
      ]
    },
    {
      channel: "Sky Racing 2",
      logo: "https://upload.wikimedia.org/wikipedia/en/9/93/Sky_au_racing.png",
      links: [
        "https://skylivetab-new.akamaized.net/hls/live/2038781/sky2/index.m3u8"
      ]
    },
    {
      channel: "Nine",
      logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b0/Nine_Network_logo_%282008%29.svg/2560px-Nine_Network_logo_%282008%29.svg.png",
      links: [
        "https://9now-livestreams-fhd-t.akamaized.net/u/prod/simulcast/bne/ch9/hls/r1/index.m3u8"
      ]
    },
    {
      channel: "Seven",
      logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Seven_Network_logo.svg/2560px-Seven_Network_logo.svg.png",
      links: [
        "https://i.mjh.nz/.r/seven-bri.m3u8"
      ]
    },
    {
      channel: "Seven Two",
      logo: "https://i.mjh.nz/.images/auto-7two-bri-701123.png",
      links: [
        "https://i.mjh.nz/.r/7two-bri.m3u8"
      ]
    },
    {
      channel: "10",
      logo: "https://10.com.au/ip/s3/2025/06/25/f4cdf0245b4ef0d5cd74929c1217a881-1384576.png",
      links: [
        "https://i.mjh.nz/.r/10-qld.m3u8"
      ]
    },
    {
      channel: "Racing.com",
      logo: "https://static.wikia.nocookie.net/logopedia/images/3/3e/RACING.COM_logo_2016.svg/revision/latest?cb=20181117180142",
      links: [
        "https://i.mjh.nz/.r/racing-fast.m3u8"
      ]
    }
  ],
  "US Sport": [
    {
      channel: "ESPN (US)",
      logo: "https://img.zuzz.tv/assets/channels/0n7d6FQkfkqe7k80zzsD3tZx6vEJuuGahPbzjCGSnk2uSK7SO2.png",
      links: [
        "http://41.205.93.154/ESPN/index.m3u8",
        "https://serv10g.zuzzplayer.xyz/hls/espn/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNS8yMDI1IDU6NTM6MjYgQU0maGFzaF92YWx1ZT1pYXhydmlQVUFTL2NCV0Q1dFhCMDRnPT0mdmFsaWRtaW51dGVzPTI4MA=="
      ]
    },
    {
      channel: "ESPN2 (US)",
      logo: "https://img.zuzz.tv/assets/channels/DbRwK42zSLyeCsWYxv1SIQcvBsHzhhEsUr8pW1pPmDoKVQtcEt.png",
      links: [
        "https://serv10g.zuzzplayer.xyz/hls/espn2/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMjEvMjAyNSAxOjI0OjA0IFBNJmhhc2hfdmFsdWU9YzZrdG91NlBMUXpwaFJFcmJNMHlpZz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g.zuzzplayer.xyz/hls/espn2/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNS8yMDI1IDU6NTQ6NDUgQU0maGFzaF92YWx1ZT1CcWI0eVZoL1V0RmpPSEt3bWtHN1V3PT0mdmFsaWRtaW51dGVzPTI4MA=="
      ]
    },
    {
      channel: "ESPNU",
      logo: "https://img.zuzz.tv/assets/channels/ADqzwrsmny6Tyc4l6K5OF9tNeEY0szYUiVaodlzI7H2JC4b6uk.png",
      links: [
        "https://fl1.moveonjoy.com/ESPN_U/index.m3u8"
      ]
    },
    {
      channel: "Big 10",
      logo: "https://img.zuzz.tv/assets/channels/big10.png",
      links: [
        "https://fl7.moveonjoy.com/BIG_TEN_NETWORK/index.m3u8"
      ]
    },
    {
      channel: "SEC Network",
      logo: "https://img.zuzz.tv/assets/channels/sec.png",
      links: [
        "http://143.244.60.30/SEC_NETWORK/index.m3u8"
      ]
    },
    {
      channel: "ACC Network",
      logo: "https://img.zuzz.tv/assets/channels/ACC.png",
      links: [
        "https://fl31.moveonjoy.com/ACC_NETWORK/index.m3u8"
      ]
    },
    {
      channel: "ACC Digital Network",
      logo: "https://img.zuzz.tv/assets/channels/ACC.png",
      links: [
        "https://raycom-accdn-firetv.amagi.tv/playlist.m3u8"
      ]
    },
    {
      channel: "Fox Sports 1",
      logo: "https://img.zuzz.tv/assets/channels/GhjV5JvfTd00OYslaebluTQ0ctK8lyOcMd4TZzvpEFlbJnITFn.png",
      links: [
        "https://fl1.moveonjoy.com/FOX_Sports_1/index.m3u8"
      ]
    },
    {
      channel: "Fox Sports 2",
      logo: "https://img.zuzz.tv/assets/channels/RrZjqqiVySHtSDHJ2nOAovVI6adigv08Nr5kK2Yvkp6mycDiIA.png",
      links: [
        "https://tvpass.org/live/FoxSports2/sd"
      ]
    },
    {
      channel: "CBS Sports Network",
      logo: "https://img.zuzz.tv/assets/channels/nQHA4H2nbSgMgsyIZxip5X0anhT605Gxq8elGxCsoXkPVzZjJD.png",
      links: [
        "https://fl1.moveonjoy.com/CBS_SPORTS_NETWORK/index.m3u8"
      ]
    },
    {
      channel: "NFL Network",
      logo: "https://img.zuzz.tv/assets/channels/3DkMPY1wYO7mFGTGispHwPtw5VWwLGQvfhJGodUp4isSONVxwI.png",
      links: [
        "https://fl1.moveonjoy.com/NFL_NETWORK/index.m3u8"
      ]
    },
    {
      channel: "NBA TV",
      logo: "https://img.zuzz.tv/assets/channels/nQWkxr73TBBJoByDoKwirX90t4efemvAVwYF15PM9Xt7uD8pk2.png",
      links: [
        "https://fl1.moveonjoy.com/NBA_TV/index.m3u8"
      ]
    },
    {
      channel: "NHL Network",
      logo: "https://img.zuzz.tv/assets/channels/fmmBmmJBXkKtQQPtny0LyE8eS3AIU6yY5mroBTv0Q6SLuriMQy.png",
      links: [
        "https://fl1.moveonjoy.com/NHL_NETWORK/index.m3u8"
      ]
    },
    {
      channel: "MLB Network",
      logo: "https://img.zuzz.tv/assets/channels/3L0eJOtGsM3dfPE3EKTyrlSOSy3eLt5gkxDWBfITnL2JXcK8D6.png",
      links: [
        "https://fl1.moveonjoy.com/MLB_NETWORK/index.m3u8"
      ]
    },
    {
      channel: "Golf Channel",
      logo: "https://img.zuzz.tv/assets/channels/uwGHnFtPLYvdhmk5x9BXEzc3orQD2HC9YQAtho6g7IjTddX27K.png",
      links: [
        "https://fl1.moveonjoy.com/GOLF/index.m3u8"
      ]
    },
    {
      channel: "SNY",
      logo: "https://upload.wikimedia.org/wikipedia/commons/1/1c/SNY_logo.svg",
      links: [
        "https://fl7.moveonjoy.com/SNY/index.m3u8"
      ]
    },
    {
      channel: "MSG HD",
      logo: "https://img.zuzz.tv/assets/channels/uTIfEcLMqxJjXaVZaGqCLBWaJCN6ML7saYVypSeCMAoVqNoNUe.png",
      links: [
        "https://fl2.moveonjoy.com/MSG/index.m3u8"
      ]
    },
    {
      channel: "YES Network",
      logo: "https://img.zuzz.tv/assets/channels/IWeXhdnKlWTNNugPeZLYDuEAhB60dTmvTcVOKk0RJoupzRYyWA.png",
      links: [
        "https://fl31.moveonjoy.com/YES_NETWORK/index.m3u8"
      ]
    },
    {
      channel: "Fanduel Detroit",
      logo: "https://press.fanduel.com/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Fpbwem9y5%2Ffanduel_common_production%2F08bd6bfd645437fd56a3edbdac4657c23312af6a-4882x4868.png&w=640&q=100",
      links: [
        "https://v4.thetvapp.to/hls/fanduel-sports-network-detroit-hd/tracks-v1a1/mono.m3u8?token=ZoSngoGO3_z9NCbYah_hDQ&expires=1765122546&user_id=MTEwLjMyLjIyMy4yNDg="
      ]
    },
    {
      channel: "NBC Sports Boston",
      logo: "https://img.zuzz.tv/assets/channels/b6MjsvM3qfQY4CZV1LVJWwFt1mVVoj3iX7gmPTH7MiP8rFWFAk.png",
      links: [
        "https://serv10g2.zuzzplayer.xyz/hls/nbc-boston/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/nbc-boston/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTUvMjAyNSAxMjozODowMyBBTSZoYXNoX3ZhbHVlPUNDaW9GbWVBQUp0b3EzNTlkOFdVa3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw"
      ]
    },
    {
      channel: "NESN",
      logo: "https://img.zuzz.tv/assets/channels/pNcr1AgqdNw9MAjXJeWzOgxwUx3XJ7CdLZs2BGThVwk3LR4C4a.png",
      links: [
        "https://serv10g2.zuzzplayer.xyz/hls/nesn12/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/nesn12/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTUvMjAyNSAxMjozODowMyBBTSZoYXNoX3ZhbHVlPUNDaW9GbWVBQUp0b3EzNTlkOFdVa3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw"
      ]
    },
    {
      channel: "Fanduel Racing",
      logo: "https://press.fanduel.com/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Fpbwem9y5%2Ffanduel_common_production%2F08bd6bfd645437fd56a3edbdac4657c23312af6a-4882x4868.png&w=640&q=100",
      links: [
        "https://fl31.moveonjoy.com/PAC_12/index.m3u8"
      ]
    }
  ],
  "Canada": [
    {
      channel: "TSN1",
      logo: "https://img.zuzz.tv/assets/channels/tQS7GnEAURnhchSfRoICM80sNF3w6cz1Oy1kERQINgnbPF5a6o.png",
      links: [
        "https://fl1.moveonjoy.com/TSN_1/index.m3u8"
      ]
    },
    {
      channel: "Sportsnet West",
      logo: "https://img.zuzz.tv/assets/channels/3uG0nL2Wp3ey1ixpKnTZppIZPoukSILXBB0WX9HyuACmyK9Z3A.png",
      links: [
        "https://serv10g2.zuzzplayer.xyz/hls/snwest/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvMy8yMDI1IDk6MTg6MDMgQU0maGFzaF92YWx1ZT1sa2IrREUrUkRGVkVaOUl6WEFFOUlnPT0mdmFsaWRtaW51dGVzPTI4MA==",
        "https://serv10g.zuzzplayer.xyz/hls/snwest/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNS8yMDI1IDU6Mjg6MDQgQU0maGFzaF92YWx1ZT1LS2EvQXp1d1J6aFpYamJsQUlwZkNRPT0mdmFsaWRtaW51dGVzPTI4MA==",
        "https://serv10g2.zuzzplayer.xyz/hls/snwest/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvMy8yMDI1IDExOjA3OjUwIFBNJmhhc2hfdmFsdWU9ZzFqZ1QyblZ1RnJNelRBTk9FekFGZz09JnZhbGlkbWludXRlcz0yODA="
      ]
    },
    {
      channel: "Sportsnet Ontario",
      logo: "https://img.zuzz.tv/assets/channels/3uG0nL2Wp3ey1ixpKnTZppIZPoukSILXBB0WX9HyuACmyK9Z3A.png",
      links: [
        "https://serv10g2.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMjEvMjAyNSAxMjo1NjozOCBQTSZoYXNoX3ZhbHVlPUN2QURyZVFHblphSnluUGVMbG5oMXc9PSZ2YWxpZG1pbnV0ZXM9Mjgw",
        "https://serv10g.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMjIvMjAyNSA3OjA1OjA1IEFNJmhhc2hfdmFsdWU9QW95M29XVmN6N3VWYzEweFJSOXZwZz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMjIvMjAyNSAxOjU3OjU2IEFNJmhhc2hfdmFsdWU9cTQ0c1NzNTh4U2loNmNuWVBVbVFOQT09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMjYvMjAyNSAyOjMyOjUxIEFNJmhhc2hfdmFsdWU9SlluakpobkNBYWR0WHJEQ1g3SFFMZz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMjgvMjAyNSAzOjAwOjExIEFNJmhhc2hfdmFsdWU9aUliQmh5eTVSclNVWjMvNjdSVVdFQT09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMjkvMjAyNSA4OjE1OjQ3IEFNJmhhc2hfdmFsdWU9bldYNGJLMkdIVWxyVUtoRENNLzRKUT09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvMS8yMDI1IDY6MjQ6MDYgQU0maGFzaF92YWx1ZT1wdFc3b2lQeFlaYXB6aTEwVnVpNVZnPT0mdmFsaWRtaW51dGVzPTI4MA==",
        "https://serv10g.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvMy8yMDI1IDEwOjE0OjI4IEFNJmhhc2hfdmFsdWU9TS94NVFuMHkwSm1QSDJwT2VlY3dIUT09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNS8yMDI1IDU6Mjk6NTQgQU0maGFzaF92YWx1ZT1hUDhTQzEvWTVtUy8wVGg2cDVuanh3PT0mdmFsaWRtaW51dGVzPTI4MA==",
        "https://serv10g.zuzzplayer.xyz/hls/snontario/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvMy8yMDI1IDExOjA2OjAyIFBNJmhhc2hfdmFsdWU9VThWa0FyR0Rwd0VYb2p2SmVIRDR5UT09JnZhbGlkbWludXRlcz0yODA=",
        "https://a1xs.vip/6000011"
      ]
    }
  ],
  "NBA": [
    {
      channel: "League Pass 1",
      logo: "https://img.zuzz.tv/assets/channels/nQWkxr73TBBJoByDoKwirX90t4efemvAVwYF15PM9Xt7uD8pk2.png",
      links: [
        "https://serv10g.zuzzplayer.xyz/hls/nba1/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTMvMjAyNSAxMjo0MDozOSBQTSZoYXNoX3ZhbHVlPUtBeFVkR0llQ2lyeHhvVnlRZmRzS3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw",
        "https://serv10g2.zuzzplayer.xyz/hls/nba1/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g.zuzzplayer.xyz/hls/nba1/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNC8yMDI1IDEyOjA4OjAyIEFNJmhhc2hfdmFsdWU9UzBLQnVtNUdIa3FSRjFXaldQLzd1QT09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/nba1/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNy8yMDI1IDEyOjA0OjEzIEFNJmhhc2hfdmFsdWU9eUpBOHdpVWV6NWphaGtKYSt4dGt4Zz09JnZhbGlkbWludXRlcz0yODA="
      ]
    },
    {
      channel: "League Pass 2",
      logo: "https://img.zuzz.tv/assets/channels/nQWkxr73TBBJoByDoKwirX90t4efemvAVwYF15PM9Xt7uD8pk2.png",
      links: [
        "https://serv10g.zuzzplayer.xyz/hls/nba2/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTMvMjAyNSAxMjo0MDozOSBQTSZoYXNoX3ZhbHVlPUtBeFVkR0llQ2lyeHhvVnlRZmRzS3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw",
        "https://serv10g2.zuzzplayer.xyz/hls/nba2/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g.zuzzplayer.xyz/hls/nba2/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNC8yMDI1IDEyOjExOjI1IEFNJmhhc2hfdmFsdWU9VmgzWC9tRk0wRWs0L1ZPQmpJSDJxdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/nba2/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNy8yMDI1IDEyOjA1OjIwIEFNJmhhc2hfdmFsdWU9Y01FKzRMZ3hHb2pqTHFxamkwZUs5Zz09JnZhbGlkbWludXRlcz0yODA="
      ]
    },
    {
      channel: "League Pass 3",
      logo: "https://img.zuzz.tv/assets/channels/nQWkxr73TBBJoByDoKwirX90t4efemvAVwYF15PM9Xt7uD8pk2.png",
      links: [
        "https://serv10g.zuzzplayer.xyz/hls/nba3/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTMvMjAyNSAxMjo0MDozOSBQTSZoYXNoX3ZhbHVlPUtBeFVkR0llQ2lyeHhvVnlRZmRzS3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw",
        "https://serv10g2.zuzzplayer.xyz/hls/nba3/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g.zuzzplayer.xyz/hls/nba3/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNC8yMDI1IDEyOjEzOjA2IEFNJmhhc2hfdmFsdWU9WlN3RlI5ODZUMW80YWNsMXB4b2RSdz09JnZhbGlkbWludXRlcz0yODA="
      ]
    },
    {
      channel: "League Pass 4",
      logo: "https://img.zuzz.tv/assets/channels/nQWkxr73TBBJoByDoKwirX90t4efemvAVwYF15PM9Xt7uD8pk2.png",
      links: [
        "https://serv10g.zuzzplayer.xyz/hls/nba4/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTMvMjAyNSAxMjo0MDozOSBQTSZoYXNoX3ZhbHVlPUtBeFVkR0llQ2lyeHhvVnlRZmRzS3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw",
        "https://serv10g2.zuzzplayer.xyz/hls/nba4/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/nba4/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNy8yMDI1IDEyOjA2OjE5IEFNJmhhc2hfdmFsdWU9cGdKL2lRTGhaeU1xWUZuaWluRFdhdz09JnZhbGlkbWludXRlcz0yODA="
      ]
    },
    {
      channel: "League Pass 5",
      logo: "https://img.zuzz.tv/assets/channels/nQWkxr73TBBJoByDoKwirX90t4efemvAVwYF15PM9Xt7uD8pk2.png",
      links: [
        "https://serv10g.zuzzplayer.xyz/hls/nba5/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTMvMjAyNSAxMjo0MDozOSBQTSZoYXNoX3ZhbHVlPUtBeFVkR0llQ2lyeHhvVnlRZmRzS3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw",
        "https://serv10g2.zuzzplayer.xyz/hls/nba5/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/nba3/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNy8yMDI1IDEyOjA3OjM0IEFNJmhhc2hfdmFsdWU9b04veHBaUkU2SUNuNjg2Y0dLRnQ0dz09JnZhbGlkbWludXRlcz0yODA=",
      ]
    },
    {
      channel: "League Pass 6",
      logo: "https://img.zuzz.tv/assets/channels/nQWkxr73TBBJoByDoKwirX90t4efemvAVwYF15PM9Xt7uD8pk2.png",
      links: [
        "https://serv10g.zuzzplayer.xyz/hls/nba6/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTMvMjAyNSAxMjo0MDozOSBQTSZoYXNoX3ZhbHVlPUtBeFVkR0llQ2lyeHhvVnlRZmRzS3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw",
        "https://serv10g2.zuzzplayer.xyz/hls/nba6/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/nba6/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNy8yMDI1IDEyOjA4OjI3IEFNJmhhc2hfdmFsdWU9cHFoazhrcVp6aWNmM0wyUGZBRU1mZz09JnZhbGlkbWludXRlcz0yODA=",
        
      ]
    },
    {
      channel: "League Pass 7",
      logo: "https://img.zuzz.tv/assets/channels/nQWkxr73TBBJoByDoKwirX90t4efemvAVwYF15PM9Xt7uD8pk2.png",
      links: [
        "https://serv10g.zuzzplayer.xyz/hls/nba7/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTMvMjAyNSAxMjo0MDozOSBQTSZoYXNoX3ZhbHVlPUtBeFVkR0llQ2lyeHhvVnlRZmRzS3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw",
        "https://serv10g2.zuzzplayer.xyz/hls/nba7/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA=",
        "https://serv10g2.zuzzplayer.xyz/hls/nba7/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTIvNy8yMDI1IDEyOjEwOjU1IEFNJmhhc2hfdmFsdWU9TVhYWDZPeDVxcy9Gc0tuazMzZkxFZz09JnZhbGlkbWludXRlcz0yODA="
      ]
    },
    {
      channel: "League Pass 8",
      logo: "https://img.zuzz.tv/assets/channels/nQWkxr73TBBJoByDoKwirX90t4efemvAVwYF15PM9Xt7uD8pk2.png",
      links: [
        "https://serv10g.zuzzplayer.xyz/hls/nba8/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTMvMjAyNSAxMjo0MDozOSBQTSZoYXNoX3ZhbHVlPUtBeFVkR0llQ2lyeHhvVnlRZmRzS3c9PSZ2YWxpZG1pbnV0ZXM9Mjgw",
        "https://serv10g2.zuzzplayer.xyz/hls/nba8/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9MTEvMTYvMjAyNSA4OjIzOjMzIEFNJmhhc2hfdmFsdWU9ZEV1bHdvMExyWXhRUFM5NVN6RHdqdz09JnZhbGlkbWludXRlcz0yODA="
      ]
    }
  ]
};

/* External Aus Streaming apps – open in separate windows snapped to panel */
const EXTERNAL_APPS = [
  {
    name: "Kayo Sports",
    url: "https://kayosports.com.au/",
    key: "Kayo",
    logo: "https://media.kayosports.com.au/content/dam/nc/fc/sm/kyo/prl/media-centre/logos/KayoSportsLogoMono.png"
  },
  {
    name: "Stan Sport",
    url: "https://play.stan.com.au/sport",
    key: "StanSport",
    logo: "https://www.stan.com.au/favicon.ico"
  },
  {
    name: "Paramount+",
    url: "https://www.paramountplus.com/collections/sports-hub-au/",
    key: "ParamountPlus",
    logo: "https://www.paramountplus.com/favicon.ico"
  },
  {
    name: "Disney+ (ESPN)",
    url: "https://www.disneyplus.com/en-gb/browse/espn",
    key: "DisneyPlusESPN",
    logo: "https://www.disneyplus.com/favicon.ico"
  }
];

let selectedVideoId = "video1";
let audioSourceVideoId = "video1";
let popupRefs = {};

/* mode: "video" or "web" per panel */
const modeByVideoId = {
  video1: "video",
  video2: "video",
  video3: "video",
  video4: "video"
};

/* remember web URLs per panel */
const webUrlByVideoId = {
  video1: null,
  video2: null,
  video3: null,
  video4: null
};

const hlsInstances = { video1: null, video2: null, video3: null, video4: null };
const linksByVideoId = { video1: [], video2: [], video3: [], video4: [] };
const currentLinkIndex = { video1: 0, video2: 0, video3: 0, video4: 0 };

let fullscreenMode = null; // null | "page" | "panel"
let castMode = false;

/* Top-controls auto-hide */
let controlsHideTimeout = null;

function hideTopControls() {
  const controls = document.getElementById("top-controls");
  if (!controls) return;
  controls.classList.add("hidden");
}

function showTopControls() {
  const controls = document.getElementById("top-controls");
  if (!controls) return;
  controls.classList.remove("hidden");
  if (controlsHideTimeout) {
    clearTimeout(controlsHideTimeout);
  }
  controlsHideTimeout = setTimeout(() => {
    hideTopControls();
  }, 3000);
}

/* ---------- LOGIN LOGIC ---------- */
function initLogin() {
  const loginScreen = document.getElementById("login-screen");
  const appContainer = document.getElementById("container");
  const userInput = document.getElementById("login-username");
  const passInput = document.getElementById("login-password");
  const rememberInput = document.getElementById("login-remember");
  const btn = document.getElementById("login-button");
  const error = document.getElementById("login-error");

  const remembered = localStorage.getItem(REMEMBER_KEY) === "1";
  if (remembered) {
    loginScreen.style.display = "none";
    appContainer.style.display = "flex";
    layoutPanels();
    return;
  }

  function doLogin() {
    const u = userInput.value.trim();
    const p = passInput.value;
    if (u === VALID_USERNAME && p === VALID_PASSWORD) {
      error.style.display = "none";

      if (rememberInput && rememberInput.checked) {
        localStorage.setItem(REMEMBER_KEY, "1");
      } else {
        localStorage.removeItem(REMEMBER_KEY);
      }

      loginScreen.classList.add("hidden");
      setTimeout(() => {
        loginScreen.style.display = "none";
      }, 300);
      appContainer.style.display = "flex";
      layoutPanels();
    } else {
      error.style.display = "block";
    }
  }

  btn.addEventListener("click", doLogin);
  passInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") doLogin();
  });
  userInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") doLogin();
  });
}

/* ---------- MEDIA MODES ---------- */

function setPanelMode(videoId, mode) {
  modeByVideoId[videoId] = mode;

  const num = videoId.replace("video", "");
  const videoContainer = document.getElementById("media_" + videoId);
  const webContainer = document.getElementById("media_web" + num);

  if (mode === "web") {
    if (videoContainer) videoContainer.style.display = "none";
    if (webContainer) webContainer.style.display = "block";
    destroyHls(videoId);
  } else {
    if (videoContainer) videoContainer.style.display = "block";
    if (webContainer) webContainer.style.display = "none";
  }
}

/* ---------- APP LOGIC ---------- */

function updateCastModeUI() {
  const body = document.body;
  if (castMode) {
    body.classList.add("cast-mode");
    const activePanel = document.querySelector('.panel[data-video="' + selectedVideoId + '"]');
    document.querySelectorAll(".panel").forEach(p => p.classList.remove("cast-active"));
    if (activePanel) activePanel.classList.add("cast-active");
  } else {
    body.classList.remove("cast-mode");
    document.querySelectorAll(".panel").forEach(p => p.classList.remove("cast-active"));
    layoutPanels();
  }
  updatePanelSelectionUI();
}

function updatePanelSelectionUI() {
  document.querySelectorAll(".panel").forEach(panel => {
    if (!castMode && panel.dataset.video === selectedVideoId) {
      panel.classList.add("panel-active");
    } else {
      panel.classList.remove("panel-active");
    }
  });
}

function setPanel(videoId) {
  selectedVideoId = videoId;
  audioSourceVideoId = videoId;
  document.querySelectorAll(".panelButton").forEach(btn => btn.classList.remove("panelSelected"));
  const btn = document.querySelector('.panelButton[data-video="' + videoId + '"]');
  if (btn) btn.classList.add("panelSelected");
  updateAudioState();
  updatePanelSelectionUI();
  updateCastModeUI();
}

function updateAudioState() {
  ["video1","video2","video3","video4"].forEach(id => {
    const v = document.getElementById(id);
    if (v) v.muted = (id !== audioSourceVideoId);
  });
}

function destroyHls(videoId) {
  if (hlsInstances[videoId]) {
    try { hlsInstances[videoId].destroy(); } catch (e) {}
    hlsInstances[videoId] = null;
  }
}

function handleStreamError(videoId) {
  const links = linksByVideoId[videoId] || [];
  let idx = currentLinkIndex[videoId] || 0;
  if (idx >= links.length - 1) {
    console.warn("All sources failed for", videoId);
    return;
  }
  currentLinkIndex[videoId] = idx + 1;
  console.log("Falling back to link index", currentLinkIndex[videoId], "for", videoId);
  actuallyLoadCurrent(videoId);
}

function actuallyLoadCurrent(videoId) {
  const video = document.getElementById(videoId);
  if (!video) return;

  setPanelMode(videoId, "video");

  const links = linksByVideoId[videoId] || [];
  const idx = currentLinkIndex[videoId] || 0;
  if (!links.length || idx >= links.length) return;
  const url = links[idx];

  destroyHls(videoId);
  video.removeAttribute("src");
  video.load();

  if (window.Hls && Hls.isSupported() && url.includes(".m3u8")) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.ERROR, (event, data) => {
      if (data && data.fatal) {
        handleStreamError(videoId);
      }
    });
    hlsInstances[videoId] = hls;
  } else {
    video.src = url;
  }

  video.onerror = () => {
    handleStreamError(videoId);
  };

  updateAudioState();
}

/* Load an HLS channel into the selected panel (video mode) */
function loadChannelIntoSelected(groupName, channelObj) {
  const videoId = selectedVideoId;
  linksByVideoId[videoId] = channelObj.links.slice();
  currentLinkIndex[videoId] = 0;

  const video = document.getElementById(videoId);
  if (video) {
    video.dataset.channelName = channelObj.channel;
  }

  const label = document.getElementById("label_" + videoId);
  if (label) {
    label.textContent = channelObj.channel;
  }

  webUrlByVideoId[videoId] = null;
  setPanelMode(videoId, "video");
  actuallyLoadCurrent(videoId);
}

/* Load a WEBSITE into the selected panel (web mode) */
function loadWebsiteIntoSelected(url, labelName) {
  const videoId = selectedVideoId;
  const num = videoId.replace("video", "");
  const iframe = document.getElementById("web" + num);
  if (!iframe) return;

  webUrlByVideoId[videoId] = url;
  iframe.src = url;

  const label = document.getElementById("label_" + videoId);
  if (label) {
    label.textContent = labelName;
  }

  setPanelMode(videoId, "web");
}

function layoutPanels() {
  const screen = document.getElementById("screen");
  const rect = screen.getBoundingClientRect();
  const w = rect.width || window.innerWidth;
  const h = rect.height || window.innerHeight;
  const midX = Math.floor(w / 2);
  const midY = Math.floor(h / 2);

  const p1 = document.getElementById("panel1");
  const p2 = document.getElementById("panel2");
  const p3 = document.getElementById("panel3");
  const p4 = document.getElementById("panel4");

  p1.style.left = "0px";
  p1.style.top = "0px";
  p1.style.width = midX + "px";
  p1.style.height = midY + "px";

  p2.style.left = midX + "px";
  p2.style.top = "0px";
  p2.style.width = (w - midX) + "px";
  p2.style.height = midY + "px";

  p3.style.left = "0px";
  p3.style.top = midY + "px";
  p3.style.width = midX + "px";
  p3.style.height = (h - midY) + "px";

  p4.style.left = midX + "px";
  p4.style.top = midY + "px";
  p4.style.width = (w - midX) + "px";
  p4.style.height = (h - midY) + "px";
}

function buildGroupsUI() {
  const container = document.getElementById("channelGroups");
  container.innerHTML = "";
  for (const groupName in CHANNEL_GROUPS) {
    if (!Object.prototype.hasOwnProperty.call(CHANNEL_GROUPS, groupName)) continue;
    const groupDiv = document.createElement("div");
    groupDiv.className = "group";

    const header = document.createElement("div");
    header.className = "group-header";
    const titleSpan = document.createElement("span");
    titleSpan.textContent = groupName;
    const chev = document.createElement("span");
    chev.className = "chevron";
    chev.textContent = "▶";
    header.appendChild(titleSpan);
    header.appendChild(chev);

    const channelsDiv = document.createElement("div");
    channelsDiv.className = "group-channels";

    const channels = CHANNEL_GROUPS[groupName];
    channels.forEach(ch => {
      const btn = document.createElement("button");
      btn.className = "channel-card";

      if (ch.logo) {
        const logo = document.createElement("img");
        logo.className = "channel-logo";
        logo.src = ch.logo;
        logo.alt = ch.channel;
        btn.appendChild(logo);
      }

      const meta = document.createElement("div");
      meta.className = "channel-meta";

      const nameSpan = document.createElement("span");
      nameSpan.className = "channel-name";
      nameSpan.textContent = ch.channel;
      meta.appendChild(nameSpan);

      const tagSpan = document.createElement("span");
      tagSpan.className = "channel-tag";
      tagSpan.textContent = groupName;
      meta.appendChild(tagSpan);

      btn.appendChild(meta);

      const live = document.createElement("span");
      live.className = "channel-live-badge";
      live.textContent = "Live";
      btn.appendChild(live);

      btn.onclick = () => loadChannelIntoSelected(groupName, ch);
      channelsDiv.appendChild(btn);
    });

    header.onclick = () => {
      const isVisible = channelsDiv.style.display === "block";
      channelsDiv.style.display = isVisible ? "none" : "block";
      chev.textContent = isVisible ? "▶" : "▼";
    };

    groupDiv.appendChild(header);
    groupDiv.appendChild(channelsDiv);
    container.appendChild(groupDiv);
  }
}

/* Build the “Aus Streaming” external apps group (collapsed by default, uses popups) */
function buildExternalAppsUI() {
  const container = document.getElementById("channelGroups");
  if (!container) return;

  const groupDiv = document.createElement("div");
  groupDiv.className = "group";

  const header = document.createElement("div");
  header.className = "group-header";
  const titleSpan = document.createElement("span");
  titleSpan.textContent = "Aus Streaming";
  const chev = document.createElement("span");
  chev.className = "chevron";
  chev.textContent = "▶";
  header.appendChild(titleSpan);
  header.appendChild(chev);

  const channelsDiv = document.createElement("div");
  channelsDiv.className = "group-channels";
  channelsDiv.style.display = "none";

  EXTERNAL_APPS.forEach(app => {
    const btn = document.createElement("button");
    btn.className = "channel-card";

    if (app.logo) {
      const logo = document.createElement("img");
      logo.className = "channel-logo";
      logo.src = app.logo;
      logo.alt = app.name;
      btn.appendChild(logo);
    }

    const meta = document.createElement("div");
    meta.className = "channel-meta";

    const nameSpan = document.createElement("span");
    nameSpan.className = "channel-name";
    nameSpan.textContent = app.name;
    meta.appendChild(nameSpan);

    const tagSpan = document.createElement("span");
    tagSpan.className = "channel-tag";
    tagSpan.textContent = "Streaming app";
    meta.appendChild(tagSpan);

    btn.appendChild(meta);

    const badge = document.createElement("span");
    badge.className = "channel-live-badge";
    badge.textContent = "Open";
    btn.appendChild(badge);

    // Use popup with auto-snap to panel and periodic focus
    btn.onclick = () => openExternalForSelectedPanel(app.url, app.key, app.name);

    channelsDiv.appendChild(btn);
  });

  header.onclick = () => {
    const isVisible = channelsDiv.style.display === "block";
    channelsDiv.style.display = isVisible ? "none" : "block";
    chev.textContent = isVisible ? "▶" : "▼";
  };

  groupDiv.appendChild(header);
  groupDiv.appendChild(channelsDiv);
  container.appendChild(groupDiv);
}

/* Custom URL stream (video mode) */
function handleCustomUrl() {
  const url = prompt("Enter stream URL (.m3u8 or other):");
  if (!url) return;
  const clean = url.trim();
  if (!clean) return;
  const videoId = selectedVideoId;
  linksByVideoId[videoId] = [clean];
  currentLinkIndex[videoId] = 0;

  const video = document.getElementById(videoId);
  if (video) {
    video.dataset.channelName = "Custom";
  }
  const label = document.getElementById("label_" + videoId);
  if (label) {
    label.textContent = "Custom";
  }
  webUrlByVideoId[videoId] = null;
  setPanelMode(videoId, "video");
  actuallyLoadCurrent(videoId);
}

/* Popup helper with auto-snap to panel AND periodic focus */
function openExternalForSelectedPanel(url, key, displayName) {
  const panelSelector = '.panel[data-video="' + selectedVideoId + '"]';
  const panel = document.querySelector(panelSelector);

  // If no panel, just open a normal tab
  if (!panel) {
    window.open(url, "_blank");
    return;
  }

  const rect = panel.getBoundingClientRect();
  const left = Math.floor(window.screenX + rect.left);
  const top = Math.floor(window.screenY + rect.top);
  const width = Math.floor(rect.width);
  const height = Math.floor(rect.height);

  const features = [
    "left=" + left,
    "top=" + top,
    "width=" + width,
    "height=" + height,
    "resizable=yes",
    "scrollbars=yes"
  ].join(",");

  const windowName = "Sportsbar_" + key + "_" + selectedVideoId;
  const win = window.open(url, windowName, features);

  if (!win) {
    alert("Your browser blocked the window. Please allow pop-ups for this site.");
    return;
  }

  // Update panel label to show what's there
  const label = document.getElementById("label_" + selectedVideoId);
  if (label && displayName) {
    label.textContent = displayName;
  }

  popupRefs[windowName] = {
    win,
    panelSelector
  };

  // Periodically re-align AND focus the popup to keep it on top
  const interval = setInterval(() => {
    const ref = popupRefs[windowName];
    if (!ref || ref.win.closed) {
      clearInterval(interval);
      delete popupRefs[windowName];
      return;
    }

    const p = document.querySelector(ref.panelSelector);
    if (!p) return;

    const r = p.getBoundingClientRect();
    const l = Math.floor(window.screenX + r.left);
    const t = Math.floor(window.screenY + r.top);
    const w = Math.floor(r.width);
    const h = Math.floor(r.height);

    try {
      ref.win.moveTo(l, t);
      ref.win.resizeTo(w, h);
      ref.win.focus();
    } catch (e) {
      // Browsers may restrict moveTo/resizeTo/focus; ignore errors
    }
  }, 1000);
}

function enterPageFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().then(() => {
      fullscreenMode = "page";
    }).catch(e => {
      console.warn("Page fullscreen failed:", e);
      fullscreenMode = null;
    });
  }
}

function exitFullscreen() {
  if (document.fullscreenElement) {
    document.exitFullscreen().catch(() => {});
  }
}

function fullscreenPanel(panelId) {
  const panel = document.getElementById(panelId);
  if (!panel) return;
  fullscreenMode = "panel";

  document.getElementById("sidebar").style.display = "none";
  const controls = document.getElementById("top-controls");
  if (controls) controls.style.display = "none";

  panel.requestFullscreen().catch(e => {
    console.warn("Panel fullscreen failed:", e);
    document.getElementById("sidebar").style.display = "block";
    if (controls) controls.style.display = "flex";
    fullscreenMode = null;
  });
}

document.addEventListener("fullscreenchange", () => {
  const controls = document.getElementById("top-controls");
  if (!document.fullscreenElement) {
    if (fullscreenMode === "panel") {
      document.getElementById("sidebar").style.display = "block";
      if (controls) controls.style.display = "flex";
      layoutPanels();
      fullscreenMode = "page";
      enterPageFullscreen();
    } else if (fullscreenMode === "page") {
      fullscreenMode = null;
    }
  }
});

function initDragAndDrop() {
  let draggedPanelId = null;

  const panels = document.querySelectorAll(".panel");
  panels.forEach(panel => {
    panel.addEventListener("dragstart", e => {
      draggedPanelId = panel.id;
      e.dataTransfer.effectAllowed = "move";
    });
    panel.addEventListener("dragover", e => {
      e.preventDefault();
      e.dataTransfer.dropEffect = "move";
      panel.classList.add("drag-over");
    });
    panel.addEventListener("dragleave", () => {
      panel.classList.remove("drag-over");
    });
    panel.addEventListener("drop", e => {
      e.preventDefault();
      panel.classList.remove("drag-over");
      if (!draggedPanelId || draggedPanelId === panel.id) return;
      swapPanels(draggedPanelId, panel.id);
      draggedPanelId = null;
    });
  });
}

function swapPanels(panelIdA, panelIdB) {
  const panelA = document.getElementById(panelIdA);
  const panelB = document.getElementById(panelIdB);
  if (!panelA || !panelB) return;

  const videoIdA = panelA.dataset.video;
  const videoIdB = panelB.dataset.video;

  const labelA = document.getElementById("label_" + videoIdA);
  const labelB = document.getElementById("label_" + videoIdB);
  const tmpLabel = labelA.textContent;
  labelA.textContent = labelB.textContent;
  labelB.textContent = tmpLabel;

  const vidA = document.getElementById(videoIdA);
  const vidB = document.getElementById(videoIdB);
  const tmpName = vidA.dataset.channelName;
  vidA.dataset.channelName = vidB.dataset.channelName;
  vidB.dataset.channelName = tmpName;

  const tmpLinks = linksByVideoId[videoIdA];
  linksByVideoId[videoIdA] = linksByVideoId[videoIdB];
  linksByVideoId[videoIdB] = tmpLinks;

  const tmpIdx = currentLinkIndex[videoIdA];
  currentLinkIndex[videoIdA] = currentLinkIndex[videoIdB];
  currentLinkIndex[videoIdB] = tmpIdx;

  const tmpMode = modeByVideoId[videoIdA];
  modeByVideoId[videoIdA] = modeByVideoId[videoIdB];
  modeByVideoId[videoIdB] = tmpMode;

  const tmpWebUrl = webUrlByVideoId[videoIdA];
  webUrlByVideoId[videoIdA] = webUrlByVideoId[videoIdB];
  webUrlByVideoId[videoIdB] = tmpWebUrl;

  [videoIdA, videoIdB].forEach((videoId) => {
    const mode = modeByVideoId[videoId];
    if (mode === "web") {
      const num = videoId.replace("video", "");
      const iframe = document.getElementById("web" + num);
      if (iframe) {
        iframe.src = webUrlByVideoId[videoId] || "about:blank";
      }
      setPanelMode(videoId, "web");
    } else {
      if (linksByVideoId[videoId] && linksByVideoId[videoId].length) {
        actuallyLoadCurrent(videoId);
      } else {
        setPanelMode(videoId, "video");
      }
    }
  });
}

window.addEventListener("load", () => {
  initLogin();
  buildGroupsUI();
  buildExternalAppsUI();
  initDragAndDrop();
  updateAudioState();
  updatePanelSelectionUI();
  showTopControls();

  document.querySelectorAll(".panel").forEach(panel => {
    const videoId = panel.dataset.video;
    if (!videoId) return;
    const controls = document.createElement("div");
    controls.className = "panel-controls";

    const reloadBtn = document.createElement("button");
    reloadBtn.className = "panel-reload-btn";
    reloadBtn.title = "Reload";
    reloadBtn.textContent = "⟳";

    reloadBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      const mode = modeByVideoId[videoId] || "video";
      if (mode === "web") {
        const num = videoId.replace("video", "");
        const iframe = document.getElementById("web" + num);
        if (iframe && iframe.src) {
          iframe.src = iframe.src;
        } else if (webUrlByVideoId[videoId]) {
          iframe.src = webUrlByVideoId[videoId];
        }
      } else {
        actuallyLoadCurrent(videoId);
      }
    });

    controls.appendChild(reloadBtn);
    panel.appendChild(controls);
  });

  const screenEl = document.getElementById("screen");
  if (screenEl) {
    screenEl.addEventListener("mousemove", (e) => {
      if (e.clientY < 120) {
        showTopControls();
      }
    });
  }

  const toggleSidebarBtn = document.getElementById("toggleSidebar");
  if (toggleSidebarBtn) {
    toggleSidebarBtn.onclick = () => {
      const sb = document.getElementById("sidebar");
      sb.classList.toggle("hidden");
      setTimeout(layoutPanels, 260);
    };
  }

  const toggleFsBtn = document.getElementById("togglePageFs");
  if (toggleFsBtn) {
    toggleFsBtn.onclick = () => {
      if (!document.fullscreenElement) {
        enterPageFullscreen();
      } else {
        exitFullscreen();
      }
    };
  }

  const castBtn = document.getElementById("toggleCastMode");
  if (castBtn) {
    castBtn.onclick = () => {
      castMode = !castMode;
      castBtn.textContent = castMode ? "Exit Full Screen Panel" : "Full Screen Panel";
      updateCastModeUI();
    };
  }

  const customUrlBtn = document.getElementById("btnCustomUrl");
  if (customUrlBtn) {
    customUrlBtn.onclick = handleCustomUrl;
  }

  document.querySelectorAll(".panelButton").forEach(btn => {
    btn.addEventListener("click", () => {
      const vid = btn.getAttribute("data-video");
      if (vid) setPanel(vid);
    });
  });

  document.querySelectorAll(".stream-player").forEach(video => {
    video.addEventListener("click", () => {
      setPanel(video.id);
    });
    video.addEventListener("dblclick", () => {
      const panelId = "panel" + video.id.replace("video", "");
      fullscreenPanel(panelId);
    });
  });
});

window.addEventListener("resize", () => {
  if (castMode) {
    updateCastModeUI();
  } else {
    setTimeout(layoutPanels, 50);
  }
});
</script>

</body>
</html>

